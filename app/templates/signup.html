<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Chat - Signup</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        body {
            background: url('/static/nature.jpg') no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
        }
    </style>
</head>
<body>
<div class="signup-container">
    <!-- a division for the logo image -->
    <div class="logo">
        <img src="/static/logo.png" alt="Nexus Logo" class="logo-img">
    </div>
    <div class="welcome">WELCOME!</div>
    <div class="leaf-top-left"></div>
    <div class="leaf-top-right"></div>

    <div class="input-group">
        <label for="sender_ip">Sender's IP</label>
        <input type="text" id="sender_ip" placeholder="Enter Sender IP" oninput="validateIP('sender_ip')">
        <div class="error-message" id="sender_ip_error"></div>
    </div>
    <div class="input-group">
        <label for="receiver_ip">Receiver's IP</label>
        <input type="text" id="receiver_ip" placeholder="Enter Receiver IP" oninput="validateIP('receiver_ip')">
        <div class="error-message" id="receiver_ip_error"></div>
    </div>
    <button class="chat-button" id="chat_button" onclick="startChat()" disabled>CHAT</button>
</div>

<script>
   <script>
function validateIP(fieldId) {
    const ipValue = document.getElementById(fieldId).value.trim();
    const errorBox = document.getElementById(fieldId + '_error');
    const chatButton = document.getElementById('chat_button');
    const ipSegments = ipValue.split('.');

    // clear old error
    errorBox.textContent = "";
    errorBox.style.color = "red";

    // basic format checks
    if (/[^0-9.]/.test(ipValue)) {
        errorBox.textContent = "Invalid characters";
    } else if (ipSegments.length > 4) {
        errorBox.textContent = "Too many parts";
    } else {
        for (let seg of ipSegments) {
            if (seg !== "" && (parseInt(seg) < 0 || parseInt(seg) > 255)) {
                errorBox.textContent = "Out of range (0-255)";
                break;
            }
        }
    }

    // enable chat only if both IPs look fine
    const senderError = document.getElementById('sender_ip_error').textContent;
    const receiverError = document.getElementById('receiver_ip_error').textContent;
    const senderInput = document.getElementById('sender_ip').value.trim();
    const receiverInput = document.getElementById('receiver_ip').value.trim();

    chatButton.disabled = !(senderError === "" && receiverError === "" && senderInput && receiverInput);
}

function startChat() {
    const senderIP = document.getElementById('sender_ip').value.trim();
    const receiverIP = document.getElementById('receiver_ip').value.trim();

    console.log("Starting chat with:", senderIP, "->", receiverIP); //test_
    window.location.href = `/chat.html?sender=${encodeURIComponent(senderIP)}&receiver=${encodeURIComponent(receiverIP)}`;
}
</script>

</script>

<div class="corner-design top-left"></div>
<div class="corner-design bottom-right"></div>

</body>
</html>
